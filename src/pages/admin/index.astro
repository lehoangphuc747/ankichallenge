---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Admin Dashboard - Anki Challenge">
  <main class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 py-12 px-4">
    <div class="max-w-6xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-12">
        <div class="inline-block bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-2 rounded-full text-sm font-bold mb-4">
          üîê Admin Dashboard
        </div>
        <h1 class="text-5xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent mb-4">
          B·∫£ng ƒêi·ªÅu Khi·ªÉn Qu·∫£n Tr·ªã
        </h1>
        <p class="text-gray-600 text-lg">Qu·∫£n l√Ω v√† theo d√µi Anki Challenge</p>
      </div>

      <!-- Quick Stats -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
        <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-purple-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">T·ªïng th√†nh vi√™n</p>
              <p class="text-3xl font-bold text-gray-900" id="totalMembers">--</p>
            </div>
            <div class="text-4xl">üë•</div>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-pink-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Ho·∫°t ƒë·ªông</p>
              <p class="text-3xl font-bold text-gray-900" id="activeMembers">--</p>
            </div>
            <div class="text-4xl">üî•</div>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-blue-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Check-in h√¥m nay</p>
              <p class="text-3xl font-bold text-gray-900" id="todayCheckins">--</p>
            </div>
            <div class="text-4xl">‚úÖ</div>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-green-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Ng√†y c√≤n l·∫°i</p>
              <p class="text-3xl font-bold text-gray-900" id="daysLeft">--</p>
            </div>
            <div class="text-4xl">üìÖ</div>
          </div>
        </div>
      </div>

      <!-- Admin Tools Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <!-- Members Management -->
        <a href="/admin/members" class="group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden transform hover:-translate-y-1">
          <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 text-white">
            <div class="text-5xl mb-3">üë•</div>
            <h3 class="text-2xl font-bold mb-2">Qu·∫£n l√Ω th√†nh vi√™n</h3>
          </div>
          <div class="p-6">
            <p class="text-gray-600 mb-4">Xem, ch·ªânh s·ª≠a v√† qu·∫£n l√Ω th√¥ng tin th√†nh vi√™n</p>
            <ul class="text-sm text-gray-500 space-y-1">
              <li>‚Ä¢ Danh s√°ch ƒë·∫ßy ƒë·ªß</li>
              <li>‚Ä¢ Ch·ªânh s·ª≠a th√¥ng tin</li>
              <li>‚Ä¢ ·∫®n/Hi·ªán th√†nh vi√™n</li>
              <li>‚Ä¢ Xem th·ªëng k√™ chi ti·∫øt</li>
            </ul>
            <div class="mt-4 flex items-center text-purple-600 font-semibold group-hover:translate-x-2 transition-transform">
              M·ªü c√¥ng c·ª• <span class="ml-2">‚Üí</span>
            </div>
          </div>
        </a>

        <!-- Check-in Management -->
        <a href="/admin/checkin" class="group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden transform hover:-translate-y-1">
          <div class="bg-gradient-to-br from-pink-500 to-pink-600 p-6 text-white">
            <div class="text-5xl mb-3">‚úÖ</div>
            <h3 class="text-2xl font-bold mb-2">Qu·∫£n l√Ω Check-in</h3>
          </div>
          <div class="p-6">
            <p class="text-gray-600 mb-4">Theo d√µi v√† qu·∫£n l√Ω check-in h√†ng ng√†y</p>
            <ul class="text-sm text-gray-500 space-y-1">
              <li>‚Ä¢ Xem l·ªãch s·ª≠ check-in</li>
              <li>‚Ä¢ Th√™m/X√≥a check-in</li>
              <li>‚Ä¢ Theo d√µi streak</li>
              <li>‚Ä¢ Th·ªëng k√™ ho·∫°t ƒë·ªông</li>
            </ul>
            <div class="mt-4 flex items-center text-pink-600 font-semibold group-hover:translate-x-2 transition-transform">
              M·ªü c√¥ng c·ª• <span class="ml-2">‚Üí</span>
            </div>
          </div>
        </a>

        <!-- Challenge Management -->
        <a href="/admin/challenges" class="group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden transform hover:-translate-y-1">
          <div class="bg-gradient-to-br from-blue-500 to-indigo-600 p-6 text-white">
            <div class="text-5xl mb-3">üéØ</div>
            <h3 class="text-2xl font-bold mb-2">Qu·∫£n l√Ω Challenges</h3>
          </div>
          <div class="p-6">
            <p class="text-gray-600 mb-4">T·∫°o v√† qu·∫£n l√Ω c√°c challenges</p>
            <ul class="text-sm text-gray-500 space-y-1">
              <li>‚Ä¢ Th√™m/S·ª≠a/X√≥a challenges</li>
              <li>‚Ä¢ Qu·∫£n l√Ω th√†nh vi√™n challenge</li>
              <li>‚Ä¢ C·∫•u h√¨nh ng√†y b·∫Øt ƒë·∫ßu/k·∫øt th√∫c</li>
              <li>‚Ä¢ Theo d√µi ti·∫øn ƒë·ªô</li>
            </ul>
            <div class="mt-4 flex items-center text-blue-600 font-semibold group-hover:translate-x-2 transition-transform">
              M·ªü c√¥ng c·ª• <span class="ml-2">‚Üí</span>
            </div>
          </div>
        </a>

        <!-- Leaderboard -->
        <a href="/" class="group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden transform hover:-translate-y-1">
          <div class="bg-gradient-to-br from-yellow-500 to-orange-600 p-6 text-white">
            <div class="text-5xl mb-3">üèÜ</div>
            <h3 class="text-2xl font-bold mb-2">B·∫£ng x·∫øp h·∫°ng</h3>
          </div>
          <div class="p-6">
            <p class="text-gray-600 mb-4">Xem b·∫£ng x·∫øp h·∫°ng c√¥ng khai</p>
            <ul class="text-sm text-gray-500 space-y-1">
              <li>‚Ä¢ X·∫øp h·∫°ng theo k·ª∑ lu·∫≠t</li>
              <li>‚Ä¢ Theo d√µi streak</li>
              <li>‚Ä¢ Th·ªëng k√™ challenge</li>
              <li>‚Ä¢ Ti·∫øn ƒë·ªô th·ª≠ th√°ch</li>
            </ul>
            <div class="mt-4 flex items-center text-orange-600 font-semibold group-hover:translate-x-2 transition-transform">
              Xem b·∫£ng x·∫øp h·∫°ng <span class="ml-2">‚Üí</span>
            </div>
          </div>
        </a>

      </div>

      <!-- Footer Note -->
      <div class="bg-yellow-50 border-l-4 border-yellow-400 rounded-lg p-6">
        <div class="flex items-start">
          <div class="text-3xl mr-4">‚ö†Ô∏è</div>
          <div>
            <h4 class="text-yellow-800 font-bold mb-2">L∆∞u √Ω quan tr·ªçng</h4>
            <ul class="text-yellow-700 text-sm space-y-1">
              <li>‚Ä¢ Trang n√†y ch·ªâ d√†nh cho Admin, kh√¥ng chia s·∫ª link n√†y c√¥ng khai</li>
              <li>‚Ä¢ Sau khi c·∫≠p nh·∫≠t d·ªØ li·ªáu b·∫±ng scripts, nh·ªõ deploy l·∫°i website</li>
              <li>‚Ä¢ Ki·ªÉm tra k·ªπ tr∆∞·ªõc khi th·ª±c hi·ªán c√°c thao t√°c quan tr·ªçng</li>
              <li>‚Ä¢ Metadata c·∫≠p nh·∫≠t: <span id="lastUpdate" class="font-mono">ƒêang t·∫£i...</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script>
  // Load and display stats
  async function loadStats() {
    try {
      // Th√™m cache-busting
      const cb = '?v=' + Date.now();
      const [usersResponse, studyRecordsResponse, metadataResponse] = await Promise.all([
        fetch('/data/users.json' + cb),
        fetch('/data/studyRecords.json' + cb),
        fetch('/data/metadata.json' + cb)
      ]);

      const usersData = await usersResponse.json();
      const studyRecordsData = await studyRecordsResponse.json();
      const metadata = await metadataResponse.json();

      // Total members
      const totalMembers = usersData.data?.length || 0;
      const activeMembers = usersData.data?.filter(u => !u.hidden).length || 0;

      // Today's check-ins
      const today = new Date().toISOString().split('T')[0];
      const todayRecords = studyRecordsData[today] || {};
      const todayCheckins = Object.keys(todayRecords).length;

      // Days left in challenge
      const endDate = new Date('2025-12-21');
      const currentDate = new Date();
      const daysLeft = Math.max(0, Math.ceil((endDate.getTime() - currentDate.getTime()) / (1000 * 60 * 60 * 24)));

      // Update UI
      document.getElementById('totalMembers')!.textContent = totalMembers.toString();
      document.getElementById('activeMembers')!.textContent = activeMembers.toString();
      document.getElementById('todayCheckins')!.textContent = todayCheckins.toString();
      document.getElementById('daysLeft')!.textContent = daysLeft.toString();

      // Last update
      if (metadata.lastUpdated) {
        const lastUpdateDate = new Date(metadata.lastUpdated);
        document.getElementById('lastUpdate')!.textContent = lastUpdateDate.toLocaleString('vi-VN');
      }

    } catch (error) {
      console.error('Error loading stats:', error);
    }
  }

  // Load stats on page load
  loadStats();
</script>

<style>
  @keyframes gradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  .aurora-button {
    background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
    background-size: 200% 200%;
    animation: gradient 3s ease infinite;
  }
</style>
