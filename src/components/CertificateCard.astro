---
import CertificateCardStyles from './CertificateCardStyles.astro';

interface Props {
  userId: number;
  challengeId: number;
  challengeName: string;
  totalDays: number;
  daysSoFar: number;
  disciplinePercentage: number;
  isCompleted: boolean;
  className?: string;
}

const { 
  userId, 
  challengeId, 
  challengeName, 
  totalDays, 
  daysSoFar, 
  disciplinePercentage, 
  isCompleted,
  className = '' 
} = Astro.props;

const cardClass = isCompleted ? 'cert-card completed' : 'cert-card progress';
const statusBadge = isCompleted 
  ? { text: 'Ho√†n th√†nh', class: 'status-done' }
  : { text: 'ƒêang di·ªÖn ra', class: 'status-doing' };
const statusText = isCompleted ? 'Ho√†n th√†nh xu·∫•t s·∫Øc' : 'ƒêang tham gia';
const watermark = isCompleted ? 'üèÜ' : '‚è≥';
---

<CertificateCardStyles />

<div class={`${cardClass} ${className}`} data-user-id={userId} data-challenge-id={challengeId}>
  <div class="cert-watermark">{watermark}</div>
  <span class={`cert-status-badge ${statusBadge.class}`}>{statusBadge.text}</span>
  
  <div class="cert-body">
    <div class="cert-header">
      <div class="cert-icon-bg">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="none">
          <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"></path>
        </svg>
      </div>
      <div>
        <h3 class="cert-title">{challengeName}</h3>
        <p class="cert-subtitle">{statusText}</p>
      </div>
    </div>

    <div class="cert-stats-row">
      <div class="cert-stat">
        <div class={`cert-stat-val ${isCompleted ? 'text-green-600' : 'text-gray-800'}`}>
          {totalDays}<span class="text-xs sm:text-sm text-gray-400 font-normal">/{daysSoFar}</span>
        </div>
        <div class="cert-stat-label">Ng√†y h·ªçc</div>
      </div>
      <div class="cert-stat">
        <div class={`cert-stat-val ${isCompleted ? 'text-blue-600' : 'text-gray-800'}`}>
          {disciplinePercentage}<span class="text-xs sm:text-sm text-gray-400 font-normal">%</span>
        </div>
        <div class="cert-stat-label">K·ª∑ lu·∫≠t</div>
      </div>
    </div>
  </div>

  <div class="cert-footer">
    <button class="btn-download-cert" onclick={`downloadCertificate(${userId}, ${challengeId}, 'html')`}>
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
      T·∫£i ch·ª©ng ch·ªâ (HTML)
    </button>
  </div>
</div>
